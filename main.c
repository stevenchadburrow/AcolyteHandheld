// Handheld PIC 32
// By: Professor Steven Chad Burrow



/*
XGA Signal 1024 x 768 @ 60 Hz timing

Interested in easy to use VGA solution for embedded applications? Click here!

General timing
Screen refresh rate	60 Hz
Vertical refresh	48.363095238095 kHz
Pixel freq.	65.0 MHz
Horizontal timing (line)
Polarity of horizontal sync pulse is negative.

Scanline part	Pixels	Time [µs]
Visible area	1024	15.753846153846
Front porch	24	0.36923076923077
Sync pulse	136	2.0923076923077
Back porch	160	2.4615384615385
Whole line	1344	20.676923076923
Vertical timing (frame)
Polarity of vertical sync pulse is negative.

Frame part	Lines	Time [ms]
Visible area	768	15.879876923077
Front porch	3	0.062030769230769
Sync pulse	6	0.12406153846154
Back porch	29	0.59963076923077
Whole frame	806	16.6656
*/

/*
// Video Color Signals
PORTH

// Video Clock Signals
Pin110,RD2,H-SYNC
Pin111,RD3,V-SYNC

// Audio
RA2-RA7,LEFT
RB2-RB7,RIGHT

// TF Card
Pin16,RG8,SPI1-MISO
Pin98,RD10,SPI1-MOSI
Pin109,RD1,SPI1-CLK
Pin97,RD9,SPI1-SS

// SPI
Pin15,RG7,SPI2-MISO
Pin99,RD11,SPI2-MOSI
Pin14,RG6,SPI2-CLK
Pin104,RD0,SPI2-SS

// I2C
Pin95,RA14,I2C1-SCL
Pin96,RA15,I2C1-SDA

// Joysticks
Pin19,RK0,JOY-A-UP
Pin51,RK1,JOY-A-DOWN
Pin52,RK2,JOY-A-LEFT
Pin53,RK3,JOY-A-RIGHT
Pin92,RK4,JOY-A-BUTTON1
Pin93,RK5,JOY-A-BUTTON2
Pin124,RF0,JOY-B-UP
Pin125,RF1,JOY-B-DOWN
Pin79,RF2,JOY-B-LEFT
Pin90,RF4,JOY-B-RIGHT
Pin91,RF5,JOY-B-BUTTON1
Pin80,RF8,JOY-B-BUTTON2
Pin94,RK6,JOY-SELECT

// Buttons
RB8-RB15

// Programmer
Pin20,MCLR
Pin36,RB0,PGED1
Pin35,RB1,PGEC1

// USB
Pin78,USBID
Pin77,D+
Pin76,D-

// Oscillator
Pin71,RC12,OSC1/CLKI
Pin72,RC15,OSC2/CLKO

// UART
Pin118,RD4,UART2-RX
Pin119,RD5,UART2-TX
*/

/*
RA0	
RA1	
RA2	AUDIO-LEFT-F
RA3	AUDIO-LEFT-E
RA4	AUDIO-LEFT-D
RA5	AUDIO-LEFT-C
RA6	AUDIO-LEFT-B
RA7	AUDIO-LEFT-A
----	
RA9	
RA10	
----	
----	
----	
RA14	I2C-SCL
RA15	I2C-SDA
RB0	PGED
RB1	PGEC
RB2	AUDIO-RIGHT-F
RB3	AUDIO-RIGHT-E
RB4	AUDIO-RIGHT-D
RB5	AUDIO-RIGHT-C
RB6	AUDIO-RIGHT-B
RB7	AUDIO-RIGHT-A
RB8	BUTTON-UP
RB9	BUTTON-DOWN
RB10	BUTTON-LEFT
RB11	BUTTON-RIGHT
RB12	BUTTON-A
RB13	BUTTON-B
RB14	BUTTON-X
RB15	BUTTON-Y
----	
RC1	
RC2	
RC3	LCD-WR
RC4	LCD-RD
----	
----	
----	
----	
----	
----	
----	
RC12	CLKI
RC13	USB-TX
RC14	USB-RX
RC15	CLKO
RD0	SPI-SS
RD1	TF-CLK
RD2	H-SYNC
RD3	V-SYNC
RD4	FT232RL-RX
RD5	FT232RL-TX
RD6	AUDIO-SD
RD7	LED
----	
RD9	TF-CS
RD10	TF-MOSI
RD11	SPI-MOSI
RD12	SHOULDER-LEFT
RD13	SHOULDER-RIGHT
RD14	BUTTON-SELECT
RD15	BUTTON-START
RE0	LCD-D0
RE1	LCD-D1
RE2	LCD-D2
RE3	LCD-D3
RE4	LCD-D4
RE5	LCD-D5
RE6	LCD-D6
RE7	LCD-D7
RE8	LCD-RS
RE9	LCD-CS
----	
----	
----	
----	
----	
----	
RF0	JOY-B-UP
RF1	JOY-B-DOWN
RF2	JOY-B-LEFT
RF3	USBID
RF4	JOY-B-RIGHT
RF5	JOY-B-BUTTON1
----	
----	
RF8	JOY-B-BUTTON2
----	
----	
----	
RF12	
RF13	
----	
----	
RG0	UART-RX
RG1	UART-TX
----	
----	
----	
----	
RG6	SPI-CLK
RG7	SPI-MISO
RG8	TF-MISO
RG9	
----	
----	
RG12	
RG13	
RG14	
RG15	
RH0	BLUE-E
RH1	BLUE-D
RH2	BLUE-C
RH3	GREEN-F
RH4	GREEN-E
RH5	GREEN-D
RH6	RED-E
RH7	RED-D
RH8	BLUE-B
RH9	BLUE-A
RH10	GREEN-C
RH11	GREEN-B
RH12	GREEN-A
RH13	RED-C
RH14	RED-B
RH15	RED-A
RJ0	PORTJ0
RJ1	PORTJ1
RJ2	PORTJ2
RJ3	PORTJ3
RJ4	PORTJ4
RJ5	PORTJ5
RJ6	PORTJ6
RJ7	PORTJ7
RJ8	PORTJ8
RJ9	PORTJ9
RJ10	PORTJ10
RJ11	PORTJ11
RJ12	PORTJ12
RJ13	PORTJ13
RJ14	PORTJ14
RJ15	PORTJ15
RK0	JOY-A-UP
RK1	JOY-A-DOWN
RK2	JOY-A-LEFT
RK3	JOY-A-RIGHT
RK4	JOY-A-BUTTON1
RK5	JOY-A-BUTTON2
RK6	JOY-SELECT
RK7	MENU
----	
----	
----	
----	
----	
----	
----	
----	

 
*/


// By the way, to convert .mp4 to .gif:
// ffmpeg -i input.mp4 -vf scale=320:-1 -r 10 -f image2pipe -vcodec ppm - | convert -delay 10 -loop 0 - output.gif


// When connecting with the UART, use:
// sudo picocom /dev/ttyUSB0


// PIC32MZ2048EFM144 Configuration Bit Settings

// 'C' source line config statements

// DEVCFG3
#pragma config USERID = 0xFFFF          // Enter Hexadecimal value (Enter Hexadecimal value)
#pragma config FMIIEN = ON              // Ethernet RMII/MII Enable (MII Enabled)
#pragma config FETHIO = OFF             // Ethernet I/O Pin Select (Alternate Ethernet I/O)
#pragma config PGL1WAY = OFF            // Permission Group Lock One Way Configuration (Allow multiple reconfigurations)
#pragma config PMDL1WAY = OFF           // Peripheral Module Disable Configuration (Allow multiple reconfigurations)
#pragma config IOL1WAY = OFF            // Peripheral Pin Select Configuration (Allow multiple reconfigurations)
#pragma config FUSBIDIO = OFF           // USB USBID Selection (Controlled by Port Function)

// DEVCFG2
#pragma config FPLLIDIV = DIV_3         // System PLL Input Divider (3x Divider)
#pragma config FPLLRNG = RANGE_5_10_MHZ// System PLL Input Range (5-10 MHz Input)
#pragma config FPLLICLK = PLL_POSC       // System PLL Input Clock Selection (FRC is input to the System PLL)
#pragma config FPLLMULT = MUL_50       // System PLL Multiplier (PLL Multiply by 50)
#pragma config FPLLODIV = DIV_2         // System PLL Output Clock Divider (2x Divider)
#pragma config UPLLFSEL = FREQ_24MHZ    // USB PLL Input Frequency Selection (USB PLL input is 24 MHz)

// DEVCFG1
#pragma config FNOSC = FRCDIV           // Oscillator Selection Bits (Fast RC Osc w/Div-by-N (FRCDIV))
#pragma config DMTINTV = WIN_127_128    // DMT Count Window Interval (Window/Interval value is 127/128 counter value)
#pragma config FSOSCEN = OFF            // Secondary Oscillator Enable (Disable SOSC)
#pragma config IESO = ON                // Internal/External Switch Over (Enabled)
#pragma config POSCMOD = HS             // Primary Oscillator Configuration (HS osc mode)
#pragma config OSCIOFNC = ON            // CLKO Output Signal Active on the OSCO Pin (Enabled)
#pragma config FCKSM = CSECME           // Clock Switching and Monitor Selection (Clock Switch Enabled, FSCM Enabled)
#pragma config WDTPS = PS1048576        // Watchdog Timer Postscaler (1:1048576)
#pragma config WDTSPGM = STOP           // Watchdog Timer Stop During Flash Programming (WDT stops during Flash programming)
#pragma config WINDIS = NORMAL          // Watchdog Timer Window Mode (Watchdog Timer is in non-Window mode)
#pragma config FWDTEN = OFF             // Watchdog Timer Enable (WDT Disabled)
#pragma config FWDTWINSZ = WINSZ_50     // Watchdog Timer Window Size (Window size is 50%)
#pragma config DMTCNT = DMT31           // Deadman Timer Count Selection (2^31 (2147483648))
#pragma config FDMTEN = OFF             // Deadman Timer Enable (Deadman Timer is disabled)

// DEVCFG0
#pragma config DEBUG = OFF              // Background Debugger Enable (Debugger is disabled)
#pragma config JTAGEN = OFF             // JTAG Enable (JTAG Disabled)
#pragma config ICESEL = ICS_PGx1        // ICE/ICD Comm Channel Select (Communicate on PGEC1/PGED1)
#pragma config TRCEN = OFF               // Trace Disable (Trace features in the CPU are disabled)
#pragma config BOOTISA = MIPS32         // Boot ISA Selection (Boot code and Exception code is MIPS32)
#pragma config FECCCON = OFF_UNLOCKED   // Dynamic Flash ECC Configuration (ECC and Dynamic ECC are disabled (ECCCON bits are writable))
//#pragma config FECCCON = ON             // Dynamic Flash ECC Configuration (Flash ECC is enabled (ECCCON bits are locked))
#pragma config FSLEEP = VREGS           // Flash Sleep Mode (Flash power down is controlled by the VREGS bit)
#pragma config DBGPER = PG_ALL          // Debug Mode CPU Access Permission (Allow CPU access to all permission regions)
#pragma config SMCLR = MCLR_NORM        // Soft Master Clear Enable bit (MCLR pin generates a normal system Reset)
#pragma config SOSCGAIN = GAIN_2X       // Secondary Oscillator Gain Control bits (2x gain setting)
#pragma config SOSCBOOST = OFF          // Secondary Oscillator Boost Kick Start Enable bit (Normal start of the oscillator)
#pragma config POSCGAIN = GAIN_2X       // Primary Oscillator Gain Control bits (2x gain setting)
#pragma config POSCBOOST = OFF          // Primary Oscillator Boost Kick Start Enable bit (Normal start of the oscillator)
#pragma config EJTAGBEN = NORMAL        // EJTAG Boot (Normal EJTAG functionality)

// DEVCP0
#pragma config CP = OFF                 // Code Protect (Protection Disabled)

// SEQ3
#pragma config TSEQ = 0xFFFF            // Boot Flash True Sequence Number (Enter Hexadecimal value)
#pragma config CSEQ = 0xFFFF            // Boot Flash Complement Sequence Number (Enter Hexadecimal value)

// #pragma config statements should precede project file includes.
// Use project enums instead of #define for ON and OFF.

#include <xc.h>

// keeps program code from being written here, reserved for NES
#pragma region name="cart_rom" origin=0x9D100000 size=0x00100000 // for NES and GB
#pragma region name="game_rom" origin=0x9D0F0000 size=0x00010000 // pack-in game

#define SYS_FREQ 260000000 // Running at 260MHz



unsigned long VirtToPhys(volatile void* p) // changed 'const' to 'volatile'
{
	return (long)p<0?((long)p&0x1fffffffL):(unsigned long)((unsigned long*)p+0x40000000L);
}

void DelayMS(unsigned int s)
{
	unsigned long count = 0x00000000;
	
	count = (unsigned long)((unsigned long)((SYS_FREQ / 1000) * s) / 2); // Convert microseconds us into how many clock ticks it will take
       
	_CP0_SET_COUNT(0); // Set Core Timer count to 0
    
	while (count > _CP0_GET_COUNT()); // Wait until Core Timer count reaches the number we calculated earlier
}

// if using UART, use command 'sudo picocom /dev/ttyUSB0' in Linux
void SendChar(char value)
{
	char temp = value;
	while (U2STAbits.UTXBF == 1) { }
	U2TXREG = (char)(temp);
}

void SendString(char *value)
{
	char temp;
	for (unsigned int i=0; i<256; i++)
	{
		temp = value[i];
		
		if (temp == '\\') break;
		else
		{
			while (U2STAbits.UTXBF == 1) { }
			U2TXREG = (char)(temp);
		}
	}
}

void SendHex(unsigned char value)
{
	unsigned char temp = value;
	while (U2STAbits.UTXBF == 1) { }
	if (temp/16 >= 10) U2TXREG = (char)(temp/16 + 'A' - 10);
	else U2TXREG = (char)(temp/16 + '0');
	while (U3STAbits.UTXBF == 1) { }
	if (temp%16 >= 10) U2TXREG = (char)(temp%16 + 'A' - 10);
	else U2TXREG = (char)(temp%16 + '0');
}

void SendLongHex(unsigned long value)
{
	unsigned long temp = value;
	SendHex((unsigned char)(temp >> 24));
	SendHex((unsigned char)(temp >> 16));
	SendHex((unsigned char)(temp >> 8));
	SendHex((unsigned char)(temp));
}

volatile unsigned long debug_opcode = 0x0000;
volatile unsigned long debug_operand_1 = 0x0000;
volatile unsigned long debug_operand_2 = 0x0000;
volatile unsigned long debug_location = 0x0000; // TEMPORARY!
volatile unsigned long debug_value = 0x0000; // TEMPORARY!

void _general_exception_handler(void)
{	
	SendString("General Exception\n\r\\");
	SendLongHex(((_CP0_GET_CAUSE() & 0x0000007C) >> 2));
	SendString("\n\r\\");
    SendLongHex(_CP0_GET_EPC());
	SendString("\n\r\\");
	SendLongHex(INTSTAT);
	SendString("\n\r\\");
	
	SendString("Debug Opcode \\");
	SendLongHex(debug_opcode); // TEMPORARY!
	SendString("\n\r\\");
	
	SendString("Debug Operand 1 \\");
	SendLongHex(debug_operand_1); // TEMPORARY!
	SendString("\n\r\\");
	
	SendString("Debug Operand 2 \\");
	SendLongHex(debug_operand_2); // TEMPORARY!
	SendString("\n\r\\");
	
	SendString("Debug Location \\");
	SendLongHex(debug_location); // TEMPORARY!
	SendString("\n\r\\");
	
	SendString("Debug Value \\");
	SendLongHex(debug_value); // TEMPORARY!
	SendString("\n\r\\");
	
	DelayMS(1000);
	
	// soft reset system
	SYSKEY = 0x0; // reset
	SYSKEY = 0xAA996655; // unlock key #1
	SYSKEY = 0x556699AA; // unlock key #2
	RSWRST = 1; // set bit to reset of system
	SYSKEY = 0x0; // re-lock
	RSWRST; // read from register to reset
	while (1) { } // wait until reset occurs
}


volatile unsigned char *cart_rom = (volatile unsigned char *)0x9D100000;
volatile unsigned char __attribute__((address(0x8006E000))) sys_ram[8192]; // used for TotalSMS
volatile unsigned char __attribute__((address(0x80070000))) cart_ram[32768]; // used as normal ram for PeanutGB and TotalSMS
volatile unsigned char __attribute__((address(0x80078000))) ext_ram[32768]; // used for pointing memory address for NES, GB, and SMS

#define SCREEN_X 768
#define SCREEN_X2 1536
#define SCREEN_Y 240
#define SCREEN_Y2 480
#define SCREEN_XY 184320
#define SCREEN_XY2 368640

// video
volatile unsigned char __attribute__((coherent,address(0x80010000))) screen_buffer[SCREEN_XY2]; // visible portion of screen
volatile unsigned char __attribute__((coherent,address(0x8006A000))) screen_line[SCREEN_X]; // black line
volatile unsigned char screen_frame = 0;
volatile unsigned int screen_scanline = 771; //1025; // start of vertical sync
volatile unsigned char __attribute__((coherent)) screen_zero[2] = { 0x00, 0x00 }; // zero value for black
volatile unsigned char screen_handheld = 0; // 0 = VGA, 1 = LCD
volatile unsigned char screen_rate = 3; // 3:1 frame rate
volatile unsigned char screen_redraw = 0;
volatile unsigned char screen_sync = 0;
volatile unsigned long screen_pixel_location = 0;
volatile unsigned short screen_menu = 0;

volatile unsigned char screen_clear_single = 0x25; // blue-grey
volatile unsigned short screen_clear_double = 0x4104; // blue-grey?

void screen_pixel_vga_raw(unsigned short pos_x, unsigned short pos_y, unsigned char color)
{
	screen_pixel_location = ((pos_y))*SCREEN_X+((pos_x*3))+(1-screen_frame)*SCREEN_XY;
	screen_buffer[(screen_pixel_location)] = (unsigned char)color;
	screen_buffer[(screen_pixel_location+1)] = (unsigned char)color;
	screen_buffer[(screen_pixel_location+2)] = (unsigned char)color;
}

void screen_pixel_lcd_raw(unsigned short pos_x, unsigned short pos_y, unsigned short color)
{
	screen_pixel_location = (((SCREEN_Y-pos_y-1)*2))+((pos_x))*SCREEN_Y2+(1-screen_frame)*SCREEN_XY;
	screen_buffer[(screen_pixel_location)] = (unsigned char)((color&0xFF00)>>8);
	screen_buffer[(screen_pixel_location+1)] = (unsigned char)(color&0x00FF);
}

#define AUDIO_LEN 256
#define AUDIO_EXT 1024

// audio
volatile unsigned char __attribute__((coherent,address(0x8006D000))) audio_buffer[AUDIO_EXT];
volatile unsigned char __attribute__((coherent,address(0x8006D800))) audio_buffer2[AUDIO_EXT];
volatile unsigned int audio_read = 0;
volatile unsigned int audio_write = 0;
volatile unsigned int audio_enable = 0;
volatile unsigned char audio_volume = 4; // 0 = lowest, 4 = highest
volatile unsigned char audio_bank = 0;

// controllers
volatile unsigned char controller_status_1 = 0x00;
volatile unsigned char controller_status_2 = 0x00;
volatile unsigned char controller_status_3 = 0x00;
volatile unsigned char controller_status_4 = 0x00;
volatile unsigned char controller_enable = 0;
volatile unsigned char controller_config = 4; // 1, 2, or 4 players
volatile unsigned char controller_detect_1 = 0x00;
volatile unsigned char controller_detect_2 = 0x00;
volatile unsigned char controller_mapping = 0; // change accordingly


const unsigned char text_bitmap[64*96] = { 
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, // 32
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,
	0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,
	0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,
	0x00,0x00,0x00,0xFF,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x00,0xFF,0x00,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,
	0x00,0x00,0xFF,0xFF,0x00,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0x00,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0xFF,0x00,
	0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,
	0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,
	0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,
	0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,
	0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,
	0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,
	0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0xFF,0x00,0xFF,0xFF,0x00,
	0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,
	0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,
	0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,
	0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,
	0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,
	0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,
	0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,
	0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,
	0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,
	0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0x00,0x00,
	0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0xFF,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0xFF,0x00,0xFF,0xFF,0x00,
	0xFF,0xFF,0x00,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,
	0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,
	0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,
	0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,
	0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,
	0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0xFF,0xFF,0x00,
	0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,
	0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,
	0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,
	0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,
	0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,
	0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0xFF,0x00,0xFF,0xFF,0x00,
	0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0xFF,0xFF,0x00,
	0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,
	0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,
	0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,
	0xFF,0xFF,0x00,0xFF,0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,
	0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,
	0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,
	0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,
	0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0xFF,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,
	0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,
	0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,
	0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,
	0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,
	0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,
	0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,
	0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,
	0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,
	0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,
	0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,
	0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,
	0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,
	0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,
	0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,
	0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,
	0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,
	0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0xFF,0x00,0xFF,0xFF,0x00,
	0xFF,0xFF,0x00,0xFF,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0xFF,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,
	0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,
	0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,
	0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,
	0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,
	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,
	0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,
	0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,
	0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0xFF,0x00,0xFF,0xFF,0x00,
	0xFF,0xFF,0x00,0xFF,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,
	0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0x00,
	0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,
	0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,
	0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,
	0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,
	0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0xFF,0xFF,0x00,
	0xFF,0xFF,0x00,0xFF,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
};

void display_character(unsigned int x, unsigned int y, unsigned char value)
{
	unsigned int pos = (unsigned int)(value - 32) * 64;
  
	if (screen_handheld == 0)
	{
		for (unsigned int i=0; i<8; i++)
		{		
			for (unsigned int j=0; j<8; j++)
			{
				if (text_bitmap[pos+i*8+j] == 0x00)
				{
					screen_pixel_vga_raw(x+j, y+i, screen_clear_single);
				}
				else
				{
					screen_pixel_vga_raw(x+j, y+i, 0xFF);
				}
			}
		}
	}
	else
	{
		for (unsigned int i=0; i<8; i++)
		{		
			for (unsigned int j=0; j<8; j++)
			{
				if (text_bitmap[pos+i*8+j] == 0x00)
				{
					screen_pixel_lcd_raw(x+j, y+i, screen_clear_double);
				}
				else
				{
					screen_pixel_lcd_raw(x+j, y+i, 0xC71C);
				}
			}
		}
	}
};

void display_inverse(unsigned int x, unsigned int y, unsigned char value)
{
	unsigned int pos = (unsigned int)(value - 32) * 64;
  
	if (screen_handheld == 0)
	{
		for (unsigned int i=0; i<8; i++)
		{		
			for (unsigned int j=0; j<8; j++)
			{
				if (text_bitmap[pos+i*8+j] == 0x00)
				{
					screen_pixel_vga_raw(x+j, y+i, 0xFF);
				}
				else
				{
					screen_pixel_vga_raw(x+j, y+i, screen_clear_single);
				}
			}
		}
	}
	else
	{
		for (unsigned int i=0; i<8; i++)
		{		
			for (unsigned int j=0; j<8; j++)
			{
				if (text_bitmap[pos+i*8+j] == 0x00)
				{
					screen_pixel_lcd_raw(x+j, y+i, 0xC71C);
				}
				else
				{
					screen_pixel_lcd_raw(x+j, y+i, screen_clear_double);
				}
			}
		}
	}
};
	
void display_decimal(unsigned int x, unsigned int y, unsigned int value)
{
	volatile unsigned int temp = 0;
	volatile unsigned int next = 0;
	
	next = value;
	
	temp = next / 10000;
	display_character(x, y, (unsigned char)(temp + '0'));
	next = next - 10000 * temp;
	
	temp = next / 1000;
	display_character(x + 0x08, y, (unsigned char)(temp + '0'));
	next = next - 1000 * temp;
	
	temp = next / 100;
	display_character(x + 0x10, y, (unsigned char)(temp + '0'));
	next = next - 100 * temp;
	
	temp = next / 10;
	display_character(x + 0x18, y, (unsigned char)(temp + '0'));
	next = next - 10 * temp;
	
	temp = next;
	display_character(x + 0x20, y, (unsigned char)(temp + '0'));
};

void display_string(unsigned int x, unsigned int y, char *value)
{
	volatile unsigned char pos = 0;
	
	while (value[pos] != '\\')
	{
		display_character(x + pos * 8, y, value[pos]);
		
		pos++;
	}
};


// USB variables
volatile char __attribute__((coherent)) usb_state_array[256];
volatile unsigned int __attribute__((coherent)) usb_cursor_x[256];
volatile unsigned int __attribute__((coherent)) usb_cursor_y[256];
volatile unsigned int __attribute__((coherent)) usb_buttons[256];
volatile unsigned char __attribute__((coherent)) usb_mode = 0xFF;
volatile unsigned char __attribute__((coherent)) usb_writepos = 0x00;
volatile unsigned char __attribute__((coherent)) usb_readpos = 0x00;

const unsigned char usb_conversion[256] = 
{
	0x00,0x00,0x00,0x00,0x61,0x62,0x63,0x64,
	0x65,0x66,0x67,0x68,0x69,0x6A,0x6B,0x6C,
	0x6D,0x6E,0x6F,0x70,0x71,0x72,0x73,0x74,
	0x75,0x76,0x77,0x78,0x79,0x7A,0x31,0x32,
	0x33,0x34,0x35,0x36,0x37,0x38,0x39,0x30,
	0x0D,0x1B,0x08,0x09,0x20,0x2D,0x3D,0x5B,
	0x5D,0x5C,0x00,0x3B,0x27,0x60,0x2C,0x2E,
	0x2F,0x00,0x1C,0x1D,0x1E,0x1F,0x0E,0x0F,
	0x17,0x07,0x16,0x18,0x19,0x15,0x00,0x00,
	0x00,0x1A,0x02,0x01,0x7F,0x03,0x04,0x14,
	0x13,0x12,0x11,0x00,0x2F,0x2A,0x2D,0x2B,
	0x0D,0x31,0x32,0x33,0x34,0x35,0x36,0x37,
	0x38,0x39,0x30,0x2E,0x00,0x00,0x00,0x3D,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

	0x00,0x00,0x00,0x00,0x41,0x42,0x43,0x44,
	0x45,0x46,0x47,0x48,0x49,0x4A,0x4B,0x4C,
	0x4D,0x4E,0x4F,0x50,0x51,0x52,0x53,0x54,
	0x55,0x56,0x57,0x58,0x59,0x5A,0x21,0x40,
	0x23,0x24,0x25,0x5E,0x26,0x2A,0x28,0x29,
	0x0D,0x1B,0x08,0x09,0x20,0x5F,0x2B,0x7B,
	0x7D,0x7C,0x00,0x3A,0x22,0x7E,0x3C,0x3E,
	0x3F,0x00,0x1C,0x1D,0x1E,0x1F,0x0E,0x0F,
	0x17,0x07,0x16,0x18,0x19,0x15,0x00,0x00,
	0x00,0x1A,0x02,0x01,0x7F,0x03,0x04,0x14,
	0x13,0x12,0x11,0x00,0x2F,0x2A,0x2D,0x2B,
	0x0D,0x30,0x31,0x32,0x33,0x34,0x35,0x36,
	0x37,0x38,0x39,0x2E,0x00,0x00,0x00,0x3D,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};



#include "lcd.c"

#include "usbhost.c"

#include "interrupts.c"
#include "sdcard.c" 

#include "ffconf.h"
#include "ff.h"
#include "ff.c"
#include "diskio.h"
#include "diskio.c"

#include "nvm.c"

void screen_flip()
{
	screen_frame = 1 - screen_frame;
	
	if (screen_handheld > 0)
	{
		lcd_draw();
	}
}

void screen_clear()
{
	if (screen_handheld == 0)
	{
		for (unsigned long i=0; i<SCREEN_XY2; i++)
		{
			screen_buffer[i] = screen_clear_single;
		}
	}
	else
	{
		for (unsigned long i=0; i<SCREEN_XY2; i+=2)
		{
			screen_buffer[i] = (unsigned char)((screen_clear_double & 0xFF00) >> 8);
			screen_buffer[i+1] = (unsigned char)((screen_clear_double & 0x00FF));
		}
	}
}

void audio_clear()
{
	for (unsigned short i=0; i<AUDIO_EXT; i++)
	{
		audio_buffer[i] = 0x00;
		audio_buffer2[i] = 0x00;
	}
}


#include "nes.c"

#include "peanut_gb.c"

#include "total_sms.c"

#include "setup.c" 

// comment out for quicker reprogramming
//#include "game.c"



volatile char __attribute__((coherent)) directory_name[16];
volatile char __attribute__((coherent)) list_name[128*12];
volatile unsigned char directory_root = 1; // root folder?
volatile unsigned short list_total = 1; // start at 1

void list_generate()
{
	// Global variables
	DIR dir; // Directory information for the current directory
	FATFS fso; // File System Object for the file system we are reading from
	FILINFO fno;

	// Wait for the disk to initialise
	while(disk_initialize(0));
	// Mount the disk
	f_mount(&fso, "", 0);
	// Change dir to the root directory
	f_chdir(directory_name);
	// Open the directory
	f_opendir(&dir, ".");
	
	unsigned int result;
	
	while (1)
	{
		for (int i=0; i<12; i++)
		{
			fno.fname[i] = 0;
			list_name[list_total*12+i] = ' ';
		}
		
		f_readdir(&dir, &fno);
		
		if (fno.fname[0] == 0) break;
		else
		{			
			for (int i=0; i<12; i++)
			{
				if (fno.fname[i] > 0x20 && fno.fname[i] < 0x80)
				{
					list_name[list_total*12+i] = fno.fname[i];
				}
				else
				{
					list_name[list_total*12+i] = ' ';
					fno.fname[i] = ' ';
				}
			}
			
			result = 0;
			
			for (int i=0; i<9; i++)
			{
				if (list_name[list_total*12+i] == '.' &&
					list_name[list_total*12+i+1] == 'N' &&
					list_name[list_total*12+i+2] == 'E' &&
					list_name[list_total*12+i+3] == 'S') // NES games
				{
					result = 1;
							
					break;
				}
				
				if (list_name[list_total*12+i] == '.' &&
					list_name[list_total*12+i+1] == 'G' &&
					list_name[list_total*12+i+2] == 'B') // GB games
				{
					result = 1;
							
					break;
				}
				
				if (list_name[list_total*12+i] == '.' &&
					list_name[list_total*12+i+1] == 'S' &&
					list_name[list_total*12+i+2] == 'M' &&
					list_name[list_total*12+i+3] == 'S') // SMS games
				{
					result = 1;
							
					break;
				}
				
				if (list_name[list_total*12+i] == '.' &&
					list_name[list_total*12+i+1] == 'G' &&
					list_name[list_total*12+i+2] == 'G') // GG games
				{
					result = 1;
							
					break;
				}
				
				if (list_name[list_total*12+i] == '.' &&
					list_name[list_total*12+i+1] == 'S' &&
					list_name[list_total*12+i+2] == 'G') // SG games
				{
					result = 1;
							
					break;
				}
			}
			
			if (result == 1)
			{
				list_total++;
			}
			else
			{
				if (directory_root == 1)
				{
					result = 1;

					for (int i=0; i<12; i++)
					{
						if (list_name[list_total*12+i] == '.') // directory
						{
							result = 0;

							break;
						}
					}

					if (result == 1)
					{
						list_total++;
					}
				}
			}
			
			if (list_total >= 128) break;
		}
	}
	
	f_rewinddir(&dir);
}

void list_display(unsigned short pos)
{
	unsigned short start = 0;
	
	if (pos >= 14) start = pos - 14;
	
	for (unsigned short i=0; i<28; i++)
	{
		if (start+i >= list_total)
		{
			display_character(0x0000, 0x0008 * i, ' ');
		
			for (unsigned short j=0; j<12; j++)
			{
				display_character(0x0008 * j + 0x0008, 0x0008 * i, ' ');
			}
		}
		else
		{
			display_character(0x0000, 0x0008 * i, ' ');

			for (unsigned short j=0; j<12; j++)
			{
				display_character(0x0008 * j + 0x0008, 0x0008 * i, list_name[(start+i)*12+j]);
			}
		}
	}
	
	if (pos >= 14)
	{
		display_character(0x0000, 0x0008 * 14, '>');
	}
	else
	{
		display_character(0x0000, 0x0008 * pos, '>');
	}
}

/*
void list_picture(unsigned short pos)
{
	char filename[16];
	unsigned char dot = 0;
	
	for (int i=0; i<16; i++)
	{
		filename[i] = 0;
	}
	
	if (pos > 0)
	{
		for (int i=0; i<12; i++)
		{
			filename[i] = list_name[pos*12+i];

			if (filename[i] == '.')
			{
				dot = i;
				break;
			}
		}

		filename[dot+1] = 'B';
		filename[dot+2] = 'M';
		filename[dot+3] = 'P';
	}
	else
	{
		filename[0] = 'P';
		filename[1] = 'L';
		filename[2] = 'A';
		filename[3] = 'Y';
		filename[4] = 'N';
		filename[5] = 'E';
		filename[6] = 'S';
		filename[7] = '.';
		filename[8] = 'B';
		filename[9] = 'M';
		filename[10] = 'P';
	}
	
	// Global variables
	FIL file; // File handle for the file we open
	DIR dir; // Directory information for the current directory
	FATFS fso; // File System Object for the file system we are reading from
	
	//SendString("Initializing disk\n\r\\");
	
	// Wait for the disk to initialise
    while(disk_initialize(0));
    // Mount the disk
    f_mount(&fso, "", 0);
    // Change dir to the root directory
    f_chdir("/");
    // Open the directory
    f_opendir(&dir, ".");
 
	unsigned char buffer[1];
	unsigned int bytes;
	unsigned int result;
	unsigned char color;
	
	result = f_open(&file, filename, FA_READ);
	if (result == 0)
	{		
		for (unsigned int i=0; i<54; i++) // header
		{
			while (f_read(&file, &buffer[0], 1, &bytes) != 0) { } // MUST READ ONE BYTE AT A TIME!!!
		}
		
		for (unsigned int i=0; i<120; i++)
		{
			for (unsigned int j=0; j<128; j++)
			{
				color = 0x00;
				
				// blue first?
				while (f_read(&file, &buffer[0], 1, &bytes) != 0) { } // MUST READ ONE BYTE AT A TIME!!!
				
				color = (color | ((buffer[0] & 0xC0) >> 6));
				
				// green second?
				while (f_read(&file, &buffer[0], 1, &bytes) != 0) { } // MUST READ ONE BYTE AT A TIME!!!
				
				color = (color | ((buffer[0] & 0xE0) >> 3));
				
				// red third?
				while (f_read(&file, &buffer[0], 1, &bytes) != 0) { } // MUST READ ONE BYTE AT A TIME!!!
				
				color = (color | ((buffer[0] & 0xE0)));
				
				screen_buffer[(180-i)*SCREEN_X + 256 + j*3] = color;
				screen_buffer[(180-i)*SCREEN_X + 256 + j*3 + 1] = color;
				screen_buffer[(180-i)*SCREEN_X + 256 + j*3 + 2] = color;
			}
		}
		
		while (f_sync(&file) != 0) { }
		while (f_close(&file) != 0) { }
		
		//SendString("Read cart picture from file\n\r\\");
	}
	else
	{		
		for (unsigned int i=0; i<240; i++)
		{
			for (unsigned int j=0; j<256; j++)
			{
				screen_buffer[(240-i)*SCREEN_X + 256 + j] = 0x00;
			}
		}
		
		//SendString("Could not read cart picture from file\n\r\\");
	}	
}
*/

void menu_display()
{	
	for (unsigned char i=0; i<26; i++)
	{
		display_character(0x0000, 0x0000 + i * 0x0008, ' ');
	}
	
	if (cart_rom[0] == 0x4E &&
		cart_rom[1] == 0x45 &&
		cart_rom[2] == 0x53) // NES
	{
		display_string(0x0000, 0x0000, " Return to Game\\");

		display_string(0x0000, 0x0008, " Switch Screens\\");

		display_string(0x0000, 0x0010, " Volume \\");
		if (audio_volume == 0) display_string(0x0040, 0x0010, "0 => 1\\");
		else if (audio_volume == 1) display_string(0x0040, 0x0010, "1 => 2\\");
		else if (audio_volume == 2) display_string(0x0040, 0x0010, "2 => 3\\");
		else if (audio_volume == 3) display_string(0x0040, 0x0010, "3 => 4\\");
		else if (audio_volume == 4) display_string(0x0040, 0x0010, "4 => 0\\");

		display_string(0x0000, 0x0018, " Mapping \\");
		if (controller_mapping == 1) display_string(0x0048, 0x0018, "1 => 2\\");
		else if (controller_mapping == 2) display_string(0x0048, 0x0018, "2 => 0\\");
		else display_string(0x0048, 0x0018, "0 => 1\\");
		
		if (nes_hack_vsync_flag == 0) display_string(0x0000, 0x0020, " Hacks Disabled => Enabled\\");
		else if (nes_hack_vsync_flag == 1) display_string(0x0000, 0x0020, " Hacks Enabled => Disabled\\");
		
		display_string(0x0000, 0x0028, " Controllers \\");
		if (controller_config == 1) display_string(0x0068, 0x0028, "1P => 2P\\");
		else if (controller_config == 2) display_string(0x0068, 0x0028, "2P => 4P\\");
		else if (controller_config == 4) display_string(0x0068, 0x0028, "4P => 1P\\");

		display_string(0x0000, 0x0030, " Frames \\");
		if (screen_rate == 2) display_string(0x0040, 0x0030, "2:1 => 3:1\\");
		else if (screen_rate == 3) display_string(0x0040, 0x0030, "3:1 => 4:1\\");
		else if (screen_rate == 4) display_string(0x0040, 0x0030, "4:1 => 5:1\\");
		else if (screen_rate == 5) display_string(0x0040, 0x0030, "5:1 => 2:1\\");

		display_string(0x0000, 0x0038, " IRQ Cycle \\");
		if (map_mmc3_irq_delay == 0) display_string(0x0058, 0x0038, "-8 =>  0\\");
		else if (map_mmc3_irq_delay == 8) display_string(0x0058, 0x0038, " 0 =>  8\\");
		else if (map_mmc3_irq_delay == 16) display_string(0x0058, 0x0038, " 8 => 32\\");
		else if (map_mmc3_irq_delay == 40) display_string(0x0058, 0x0038, "32 => -8\\");

		display_string(0x0000, 0x0040, " IRQ Line \\");
		if (map_mmc3_irq_shift == 0) display_string(0x0050, 0x0040, "-1 =>  0\\");
		else if (map_mmc3_irq_shift == 1) display_string(0x0050, 0x0040, " 0 =>  1\\");
		else if (map_mmc3_irq_shift == 2) display_string(0x0050, 0x0040, " 1 =>  2\\");
		else if (map_mmc3_irq_shift == 3) display_string(0x0050, 0x0040, " 2 => -1\\");

		display_string(0x0000, 0x0048, " Load Game A\\");
		display_string(0x0000, 0x0050, " Load Game B\\");
		display_string(0x0000, 0x0058, " Load State C\\");
		display_string(0x0000, 0x0060, " Load State D\\");
		display_string(0x0000, 0x0068, " Save Game A\\");
		display_string(0x0000, 0x0070, " Save Game B\\");
		display_string(0x0000, 0x0078, " Save State C\\");
		display_string(0x0000, 0x0080, " Save State D\\");
	}
	else if (cart_rom[0x0104] == 0xCE &&
		cart_rom[0x0105] == 0xED &&
		cart_rom[0x0106] == 0x66 &&
		cart_rom[0x0107] == 0x66) // GB
	{
		display_string(0x0000, 0x0000, " Return to Game\\");

		display_string(0x0000, 0x0008, " Switch Screens\\");
		
		display_string(0x0000, 0x0010, " Volume \\");
		if (audio_volume == 0) display_string(0x0040, 0x0010, "0 => 1\\");
		else if (audio_volume == 1) display_string(0x0040, 0x0010, "1 => 2\\");
		else if (audio_volume == 2) display_string(0x0040, 0x0010, "2 => 3\\");
		else if (audio_volume == 3) display_string(0x0040, 0x0010, "3 => 4\\");
		else if (audio_volume == 4) display_string(0x0040, 0x0010, "4 => 0\\");
		
		display_string(0x0000, 0x0018, " Mapping \\");
		if (controller_mapping == 1) display_string(0x0048, 0x0018, "1 => 2\\");
		else if (controller_mapping == 2) display_string(0x0048, 0x0018, "2 => 0\\");
		else display_string(0x0048, 0x0018, "0 => 1\\");
		
		display_string(0x0000, 0x0020, " Palette \\");
		if (palette_num < 10)
		{
			display_character(0x0048, 0x0020, ' ');
			display_character(0x0050, 0x0020, (char)(palette_num + '0'));
		}
		else
		{
			display_character(0x0048, 0x0020, '1');
			display_character(0x0050, 0x0020, (char)((palette_num % 10) + '0'));
		}
		display_string(0x0058, 0x0020, " => \\");
		if (palette_num >= 15)
		{
			display_character(0x0078, 0x0020, ' ');
			display_character(0x0080, 0x0020, '0');
		}
		else if (palette_num < 9)
		{
			display_character(0x0078, 0x0020, ' ');
			display_character(0x0080, 0x0020, (char)((palette_num+1) + '0'));
		}
		else
		{
			display_character(0x0078, 0x0020, '1');
			display_character(0x0080, 0x0020, (char)(((palette_num+1) % 10) + '0'));
		}
		
		display_string(0x0000, 0x0028, " Load Game E\\");
		display_string(0x0000, 0x0030, " Load Game F\\");
		display_string(0x0000, 0x0038, " Save Game E\\");
		display_string(0x0000, 0x0040, " Save Game F\\");
	}
	else // SEGA
	{
		display_string(0x0000, 0x0000, " Return to Game\\");

		display_string(0x0000, 0x0008, " Switch Screens\\");
		
		display_string(0x0000, 0x0010, " Volume \\");
		if (audio_volume == 0) display_string(0x0040, 0x0010, "0 => 1\\");
		else if (audio_volume == 1) display_string(0x0040, 0x0010, "1 => 2\\");
		else if (audio_volume == 2) display_string(0x0040, 0x0010, "2 => 3\\");
		else if (audio_volume == 3) display_string(0x0040, 0x0010, "3 => 4\\");
		else if (audio_volume == 4) display_string(0x0040, 0x0010, "4 => 0\\");
		
		display_string(0x0000, 0x0018, " Mapping \\");
		if (controller_mapping == 1) display_string(0x0048, 0x0018, "1 => 2\\");
		else if (controller_mapping == 2) display_string(0x0048, 0x0018, "2 => 0\\");
		else display_string(0x0048, 0x0018, "0 => 1\\");
		
		if (button_disable == 0) display_string(0x0000, 0x0020, " Buttons Enabled => Disabled\\");
		else if (button_disable == 1) display_string(0x0000, 0x0020, " Buttons Disabled => Enabled\\");
		
		display_string(0x0000, 0x0028, " Load Game G\\");
		display_string(0x0000, 0x0030, " Load Game H\\");
		display_string(0x0000, 0x0038, " Save Game G\\");
		display_string(0x0000, 0x0040, " Save Game H\\");
	}
}

void menu_function()
{
	while ((controller_status_1 & 0x08) == 0x08 ||
		(controller_status_2 & 0x08) == 0x08 ||
		(controller_status_3 & 0x08) == 0x08 ||
		(controller_status_4 & 0x08) == 0x08)
	{
		USBHostTasks();
	}
	
	screen_clear();
	audio_clear();

	unsigned short menu_pos = 0;
	unsigned long menu_wait = 0x0007FFFF;
	unsigned char menu_loop = 1;

	DelayMS(500);

	while (menu_loop > 0)
	{
		menu_display();

		display_character(0x0000, 0x0008*menu_pos, '>');

		screen_flip();

		while (((controller_status_1 & 0x08) == 0x00 &&
			(controller_status_2 & 0x08) == 0x00 &&
			(controller_status_3 & 0x08) == 0x00 &&
			(controller_status_4 & 0x08) == 0x00) ||
			menu_wait > 0)
		{	
			USBHostTasks();

			if (((controller_status_1 & 0x10) == 0x10 ||
				(controller_status_2 & 0x10) == 0x10 ||
				(controller_status_3 & 0x10) == 0x10 ||
				(controller_status_4 & 0x10) == 0x10) && 
				menu_wait == 0)
			{
				menu_wait = 0x0007FFFF;

				if (menu_pos > 0) menu_pos--;

				menu_display();

				display_character(0x0000, 0x0008*menu_pos, '>');

				screen_flip();
			}
			else
			{
				if (menu_wait > 0) menu_wait--;
			}

			if (((controller_status_1 & 0x20) == 0x20 ||
				(controller_status_2 & 0x20) == 0x20 ||
				(controller_status_3 & 0x20) == 0x20 ||
				(controller_status_4 & 0x20) == 0x20) && 
				menu_wait == 0)
			{
				menu_wait = 0x0007FFFF;

				if (menu_pos < 25) menu_pos++;

				menu_display();

				display_character(0x0000, 0x0008*menu_pos, '>');

				screen_flip();
			}
			else
			{
				if (menu_wait > 0) menu_wait--;
			}
		}

		menu_wait = 0x0007FFFF;

		DelayMS(500);

		if (cart_rom[0] == 0x4E && // N
			cart_rom[1] == 0x45 && // E
			cart_rom[2] == 0x53) // S
		{
			if (menu_pos == 0)
			{
				menu_loop = 0;
			}
			else if (menu_pos == 1)
			{
				screen_handheld = 1 - screen_handheld;
				screen_clear();
				audio_clear();
				lcd_init();
				if (screen_handheld == 0) { Display(); screen_clear(); }
				menu_loop = 0;
			}
			else if (menu_pos == 2)
			{
				if (audio_volume == 0) { audio_enable = 1; nes_audio_flag = 1; audio_volume = 1; }
				else if (audio_volume == 1) { audio_enable = 1; nes_audio_flag = 1; audio_volume = 2; }
				else if (audio_volume == 2) { audio_enable = 1; nes_audio_flag = 1; audio_volume = 3; }
				else if (audio_volume == 3) { audio_enable = 1; nes_audio_flag = 1; audio_volume = 4; }
				else if (audio_volume == 4) { audio_enable = 0; nes_audio_flag = 0; audio_volume = 0; }
				menu_wait = 0x0007FFFF;
			}
			else if (menu_pos == 3)
			{
				if (controller_mapping == 0) controller_mapping = 1;
				else if (controller_mapping == 1) controller_mapping = 2;
				else controller_mapping = 0;
				menu_wait = 0x0007FFFF;
			}
			else if (menu_pos == 4)
			{ 
				if (nes_hack_vsync_flag == 0) { nes_hack_sprite_priority = 1; nes_hack_vsync_flag = 1; nes_hack_border_shrink = 1; }
				else if (nes_hack_vsync_flag == 1) { nes_hack_sprite_priority = 0; nes_hack_vsync_flag = 0; nes_hack_border_shrink = 0; }
				menu_wait = 0x0007FFFF;
			}
			else if (menu_pos == 5)
			{
				if (controller_config == 4) controller_config = 1;
				else if (controller_config == 1) controller_config = 2;
				else if (controller_config == 2) controller_config = 4;
				menu_wait = 0x0007FFFF;
			}
			else if (menu_pos == 6)
			{
				if (screen_rate == 5) screen_rate = 2;
				else if (screen_rate == 2) screen_rate = 3;
				else if (screen_rate == 3) screen_rate = 4;
				else if (screen_rate == 4) screen_rate = 5;
				menu_wait = 0x0007FFFF;
			}
			else if (menu_pos == 7)
			{ 
				if (map_mmc3_irq_delay == 40) map_mmc3_irq_delay = 0;
				else if (map_mmc3_irq_delay == 0) map_mmc3_irq_delay = 8;
				else if (map_mmc3_irq_delay == 8) map_mmc3_irq_delay = 16;
				else if (map_mmc3_irq_delay == 16) map_mmc3_irq_delay = 40;
				menu_wait = 0x0007FFFF;
			}
			else if (menu_pos == 8)
			{
				if (map_mmc3_irq_shift == 3) map_mmc3_irq_shift = 0;
				else if (map_mmc3_irq_shift == 0) map_mmc3_irq_shift = 1;
				else if (map_mmc3_irq_shift == 1) map_mmc3_irq_shift = 2;
				else if (map_mmc3_irq_shift == 2) map_mmc3_irq_shift = 3;
				menu_wait = 0x0007FFFF;
			}
			else if (menu_pos == 9)
			{
				nes_load("GAME-A.SAV");

				nes_reset_flag = 0;

				menu_loop = 0;
			}
			else if (menu_pos == 10)
			{
				nes_load("GAME-B.SAV");

				nes_reset_flag = 0;

				menu_loop = 0;
			}
			else if (menu_pos == 11)
			{
				nes_state_load("GAME-C.SAV");

				menu_loop = 0;
			}
			else if (menu_pos == 12)
			{
				nes_state_load("GAME-D.SAV");

				menu_loop = 0;
			}
			else if (menu_pos == 13)
			{
				nes_save("GAME-A.SAV");

				menu_loop = 0;
			}
			else if (menu_pos == 14)
			{
				nes_save("GAME-B.SAV");

				menu_loop = 0;
			}
			else if (menu_pos == 15)
			{
				nes_state_save("GAME-C.SAV");

				menu_loop = 0;
			}
			else if (menu_pos == 16)
			{
				nes_state_save("GAME-D.SAV");

				menu_loop = 0;
			}

			nes_init();
		}
		else if (cart_rom[0x0104] == 0xCE &&
			cart_rom[0x0105] == 0xED &&
			cart_rom[0x0106] == 0x66 &&
			cart_rom[0x0107] == 0x66) // GB
		{
			if (menu_pos == 0)
			{
				menu_loop = 0;
			}
			else if (menu_pos == 1)
			{
				screen_handheld = 1 - screen_handheld;
				screen_clear();
				audio_clear();
				lcd_init();
				if (screen_handheld == 0) { Display(); screen_clear(); }
				menu_loop = 0;
			}
			else if (menu_pos == 2)
			{
				if (audio_volume == 0) { audio_enable = 1; audio_volume = 1; }
				else if (audio_volume == 1) { audio_enable = 1; audio_volume = 2; }
				else if (audio_volume == 2) { audio_enable = 1; audio_volume = 3; }
				else if (audio_volume == 3) { audio_enable = 1; audio_volume = 4; }
				else if (audio_volume == 4) { audio_enable = 0; audio_volume = 0; }
				menu_wait = 0x0007FFFF;
			}
			else if (menu_pos == 3)
			{
				if (controller_mapping == 0) controller_mapping = 1;
				else if (controller_mapping == 1) controller_mapping = 2;
				else controller_mapping = 0;
				menu_wait = 0x0007FFFF;
			}
			else if (menu_pos == 4)
			{
				palette_num++;
				if (palette_num >= 16) palette_num = 0;
				auto_assign_palette(0, palette_num);
				menu_wait = 0x0007FFFF;
			}
			else if (menu_pos == 5)
			{
				gb_read_cart_ram_file("GAME-E.SAV");

				reset_check = 1;

				menu_loop = 0;
			}
			else if (menu_pos == 6)
			{
				gb_read_cart_ram_file("GAME-F.SAV");

				reset_check = 1;

				menu_loop = 0;
			}
			else if (menu_pos == 7)
			{
				gb_write_cart_ram_file("GAME-E.SAV");

				reset_check = 0;

				menu_loop = 0;
			}
			else if (menu_pos == 8)
			{
				gb_write_cart_ram_file("GAME-F.SAV");

				reset_check = 0;

				menu_loop = 0;
			}
		}
		else // SEGA
		{
			if (menu_pos == 0)
			{
				menu_loop = 0;
			}
			else if (menu_pos == 1)
			{
				screen_handheld = 1 - screen_handheld;
				screen_clear();
				audio_clear();
				lcd_init();
				if (screen_handheld == 0) { Display(); screen_clear(); }
				menu_loop = 0;
			}
			else if (menu_pos == 2)
			{
				if (audio_volume == 0) { audio_enable = 1; audio_volume = 1; }
				else if (audio_volume == 1) { audio_enable = 1; audio_volume = 2; }
				else if (audio_volume == 2) { audio_enable = 1; audio_volume = 3; }
				else if (audio_volume == 3) { audio_enable = 1; audio_volume = 4; }
				else if (audio_volume == 4) { audio_enable = 0; audio_volume = 0; }
				menu_wait = 0x0007FFFF;
			}
			else if (menu_pos == 3)
			{
				if (controller_mapping == 0) controller_mapping = 1;
				else if (controller_mapping == 1) controller_mapping = 2;
				else controller_mapping = 0;
				menu_wait = 0x0007FFFF;
			}
			else if (menu_pos == 4)
			{
				if (button_disable == 0) button_disable = 1;
				else button_disable = 0;
				menu_wait = 0x0007FFFF;
			}
			else if (menu_pos == 5)
			{
				gb_read_cart_ram_file("GAME-G.SAV");

				reset_check = 1;

				menu_loop = 0;
			}
			else if (menu_pos == 6)
			{
				gb_read_cart_ram_file("GAME-H.SAV");

				reset_check = 1;

				menu_loop = 0;
			}
			else if (menu_pos == 7)
			{
				gb_write_cart_ram_file("GAME-G.SAV");

				reset_check = 0;

				menu_loop = 0;
			}
			else if (menu_pos == 8)
			{
				gb_write_cart_ram_file("GAME-H.SAV");

				reset_check = 0;

				menu_loop = 0;
			}
		}

		screen_redraw = 1;

		screen_clear();
		audio_clear();
	}
	
	screen_clear();
	audio_clear();
	
	screen_flip();

	DelayMS(1000);
}

volatile void __attribute__((vector(_CHANGE_NOTICE_K_VECTOR),interrupt(ipl1srs),optimize("O1"))) cnd_handler()
{
	IFS3bits.CNKIF = 0;  // clear interrupt flag
	
	unsigned short port = PORTK; // capture data
	unsigned short flags = CNFK;
	
	CNFK = 0x0000; // must clear out the flags when done
	
	if (((flags & 0x0080) == 0x0080) && ((port & 0x0080) == 0x0000)) // RK7 (menu button) pressed down
	{
		screen_clear();
		audio_clear();

		// if in main menu, just switch screens with this button
		if (screen_menu > 0)
		{
			screen_handheld = 1 - screen_handheld;

			screen_clear();
			audio_clear();

			lcd_init();
			if (screen_handheld == 0) { Display(); screen_clear(); }

			screen_redraw = 1;

			DelayMS(1000);

			return;
		}
		
		menu_function();
	}
	
	return;
}

void game_loop(unsigned char override)
{
	while (!(controller_status_1 == 0x00 &&
		controller_status_2 == 0x00 &&
		controller_status_3 == 0x00 &&
		controller_status_4 == 0x00)) { }
	
	screen_menu = 0;
	
	DelayMS(1000);
	
	if ((cart_rom[0] == 0x4E && // N
		cart_rom[1] == 0x45 && // E
		cart_rom[2] == 0x53) || override == 1) // S
	{
		controller_config = 2; // start with 2 players
		
		nes_timers();

		nes_init();

		DelayMS(1000);

		while (1)
		{ 
			if (usb_mode != 0xFF)
			{
				USBHostTasks();
			}

			nes_loop(screen_rate); // frame rate divider and external interrupt
		}
	}
	else if ((cart_rom[0x0104] == 0xCE &&
		cart_rom[0x0105] == 0xED &&
		cart_rom[0x0106] == 0x66 &&
		cart_rom[0x0107] == 0x66) || override == 2) // GB
	{
		controller_config = 1; // only one player
		
		PeanutGB();
	}
	else if ((cart_rom[0x7FF4] == 0x53 &&
		cart_rom[0x7FF5] == 0x45 &&
		cart_rom[0x7FF6] == 0x47 &&
		cart_rom[0x7FF7] == 0x41) ||
		(override == 3 || override == 4)) // SEGA
	{
		if (((cart_rom[0x7FFF] & 0xF0) == 0x30 ||
			(cart_rom[0x7FFF] & 0xF0) == 0x40) || override == 3)  // SMS
		{
			controller_config = 2; // two players
			button_disable = 1; // disable pause/reset by default
		
			TotalSMS(0); // SMS
		}
		else if (((cart_rom[0x7FFF] & 0xF0) == 0x50 ||
			(cart_rom[0x7FFF] & 0xF0) == 0x60 ||
			(cart_rom[0x7FFF] & 0xF0) == 0x70) || override == 4) // GG
		{
			controller_config = 1; // one player
			button_disable = 0; // enable pause/reset by default

			TotalSMS(1); // GG
		}
		else
		{
			controller_config = 2; // two players
			button_disable = 1; // disable pause/reset by default

			TotalSMS(2); // try SG-1000?
		}
	}
	else 
	{
		controller_config = 2; // two players
		button_disable = 1; // disable pause/reset by default

		TotalSMS(2); // try SG-1000?
	}
}

// Start with optimize("O1")
// then add more!
// definitely bad optimizations are: gcse
// probably bad optimizations are: inline-small-functions,caller-saves,strict-aliasing
// undecided optimizations: align-functions,align-loops,align_labels
// good optimizations: expensive-optimizations,peephole,unroll-loops


int main()
{	
	unsigned short menu_pos = 0;
	unsigned long menu_wait = 0;
	unsigned long menu_delay = 0;
	
	audio_enable = 0;
	controller_enable = 1;
	screen_frame = 0;
	screen_menu = 1;
	
	Setup();
	Display();
	
	screen_clear();
	audio_clear();
	
	PORTDbits.RD7 = 0; // turn on LED
	
	DelayMS(100);
	DelayMS(100);
	DelayMS(100);
	DelayMS(100);
	DelayMS(100);
	
	// if menu button held down during boot, start in VGA
	if ((!PORTKbits.RK7)) screen_handheld = 0;
	else screen_handheld = 1;

	USBHostSetup();
	
	DelayMS(100);
	DelayMS(100);
	DelayMS(100);
	DelayMS(100);
	DelayMS(100);
	
	// if controllers detected, start in VGA
	if (controller_detect_1 > 0 || controller_detect_2 > 0) screen_handheld = 0;
	
	// if USB device detected, start in VGA
	if (usbhost_connected > 0) screen_handheld = 0;
	
	screen_clear();
	audio_clear();
	
	lcd_init();
	
	DelayMS(100);
	DelayMS(100);
	DelayMS(100);
	DelayMS(100);
	DelayMS(100);
	
	SendChar('$'); // just a 'hello world' over the UART
	
	DelayMS(100);
	DelayMS(100);
	DelayMS(100);
	DelayMS(100);
	DelayMS(100);
	
	PORTDbits.RD7 = 1; // turn off LED
	
	audio_enable = 0;
	controller_enable = 1;
	screen_frame = 0;
	screen_menu = 1;
	
	unsigned short sdcard_flag = 0;
	
	//SendString("Checking TF Card...\n\r\\");
	
	// Wait for the disk to initialise
    if (disk_initialize(0) == 0)
	{
		sdcard_flag = 1;
	}
	
	if (sdcard_flag == 0)
	{
		//SendString("TF Card Not Found!\n\r\\");
		
		screen_redraw = 1;
		
		while (1)
		{	
			USBHostTasks();
			
			if (screen_redraw > 0)
			{
				screen_redraw = 0;
				
				screen_clear();
				audio_clear();

				display_string(0x0000, 0x0000, "TF Card Not Detected\\");

				screen_flip();

				DelayMS(100);

				display_string(0x0000, 0x0000, "TF Card Not Detected\\");

				screen_flip();

				DelayMS(100);
			}
			
			if ((controller_status_1 & 0x08) == 0x08 ||
				(controller_status_2 & 0x08) == 0x08 ||
				(controller_status_3 & 0x08) == 0x08 ||
				(controller_status_4 & 0x08) == 0x08)
			{
				screen_clear();
				audio_clear();
				
				audio_enable = 1; // audio on by default
				controller_enable = 1; // must be on to play games

				if (((controller_status_1 & 0x01) == 0x01 && (controller_status_1 & 0x02) == 0x02) || 
					((controller_status_2 & 0x01) == 0x01 && (controller_status_2 & 0x02) == 0x02) || 
					((controller_status_3 & 0x01) == 0x01 && (controller_status_3 & 0x02) == 0x02) || 
					((controller_status_4 & 0x01) == 0x01 && (controller_status_4 & 0x02) == 0x02))
				{
					cart_rom = (volatile unsigned char *)0x9D0F0000; // change cart_rom to pack-in-game
				}

				if ((controller_status_1 & 0x04) == 0x04 || 
					(controller_status_2 & 0x04) == 0x04 || 
					(controller_status_3 & 0x04) == 0x04 || 
					(controller_status_4 & 0x04) == 0x04)
				{
					menu_function(); // go to menu immediately if holding select
				}
				
				if ((controller_status_1 & 0x10) == 0x10 ||
					(controller_status_2 & 0x10) == 0x10 ||
					(controller_status_3 & 0x10) == 0x10 ||
					(controller_status_4 & 0x10) == 0x10) // UP, GB override
				{
					game_loop(2);
				}
				else if ((controller_status_1 & 0x40) == 0x40 ||
					(controller_status_2 & 0x40) == 0x40 ||
					(controller_status_3 & 0x40) == 0x40 ||
					(controller_status_4 & 0x40) == 0x40) // LEFT, SMS override
				{
					game_loop(3);
				}
				else if ((controller_status_1 & 0x80) == 0x80 ||
					(controller_status_2 & 0x80) == 0x80 ||
					(controller_status_3 & 0x80) == 0x80 ||
					(controller_status_4 & 0x80) == 0x80) // RIGHT, GG override
				{
					game_loop(4);
				}
				else
				{
					game_loop(0); // check rom header to decide
				}
			}
		}
	}
	
	//SendString("TF Card Found!\n\r\\");
	
	// top option
	list_name[0] = 'P';
	list_name[1] = 'l';
	list_name[2] = 'a';
	list_name[3] = 'y';
	list_name[4] = ' ';
	list_name[5] = 'G';
	list_name[6] = 'a';
	list_name[7] = 'm';
	list_name[8] = 'e';
	list_name[9] = '!';
	list_name[10] = ' ';
	list_name[11] = ' ';
	
	// root directory
	directory_name[0] = '/';
	directory_name[1] = 0;
	directory_name[2] = 0;
	directory_name[3] = 0;
	directory_name[4] = 0;
	directory_name[5] = 0;
	directory_name[6] = 0;
	directory_name[7] = 0;
	directory_name[8] = 0;
	directory_name[9] = 0;
	directory_name[10] = 0;
	directory_name[11] = 0;
	
	directory_root = 1; // root
	
	while (1)
	{
		while ((controller_status_1 & 0x08) == 0x08 || 
			(controller_status_2 & 0x08) == 0x08 ||
			(controller_status_3 & 0x08) == 0x08 || 
			(controller_status_4 & 0x08) == 0x08)
		{
			USBHostTasks();
		}
		
		DelayMS(100);
		DelayMS(100);
		DelayMS(100);
		DelayMS(100);
		DelayMS(100);
		
		list_total = 1; // start at 1
		
		list_generate();

		if (list_total == 1) // in case of a blank folder
		{
			// top option
			list_name[0] = 'P';
			list_name[1] = 'l';
			list_name[2] = 'a';
			list_name[3] = 'y';
			list_name[4] = ' ';
			list_name[5] = 'G';
			list_name[6] = 'a';
			list_name[7] = 'm';
			list_name[8] = 'e';
			list_name[9] = '!';
			list_name[10] = ' ';
			list_name[11] = ' ';
			
			// root directory
			directory_name[0] = '/';
			directory_name[1] = 0;
			directory_name[2] = 0;
			directory_name[3] = 0;
			directory_name[4] = 0;
			directory_name[5] = 0;
			directory_name[6] = 0;
			directory_name[7] = 0;
			directory_name[8] = 0;
			directory_name[9] = 0;
			directory_name[10] = 0;
			directory_name[11] = 0;
			
			directory_root = 1;
			
			list_generate();
		}
		
		menu_pos = 0;
		menu_wait = 0x0007FFFF;

		list_display(menu_pos);
		screen_flip();

		//list_picture(menu_pos);
		
		while (((controller_status_1 & 0x08) == 0x00 && 
			(controller_status_2 & 0x08) == 0x00 &&
			(controller_status_3 & 0x08) == 0x00 && 
			(controller_status_4 & 0x08) == 0x00) ||
			menu_wait > 0)
		{			
			USBHostTasks();

			if (screen_redraw > 0)
			{
				screen_redraw = 0;

				list_display(menu_pos);
				screen_flip();
			}

			if (((controller_status_1 & 0x10) == 0x10 ||
				(controller_status_2 & 0x10) == 0x10 ||
				(controller_status_3 & 0x10) == 0x10 ||
				(controller_status_4 & 0x10) == 0x10) &&
				menu_wait == 0)
			{
				menu_wait = 0x0007FFFF;

				if (menu_pos > 0) menu_pos--;

				list_display(menu_pos);
				screen_flip();

				//for (unsigned int i=0; i<240; i++)
				//{
				//	for (unsigned int j=0; j<384; j++)
				//	{
				//		screen_buffer[(240-i)*SCREEN_X + 256 + j] = 0x00;
				//	}
				//}
			}
			else
			{
				if (menu_wait > 0) menu_wait--;
			}

			if (((controller_status_1 & 0x20) == 0x20 ||
				(controller_status_2 & 0x20) == 0x20 ||
				(controller_status_3 & 0x20) == 0x20 ||
				(controller_status_4 & 0x20) == 0x20) && 
				menu_wait == 0)
			{
				menu_wait = 0x0007FFFF;

				if (menu_pos < list_total-1) menu_pos++;

				list_display(menu_pos);
				screen_flip();

				//for (unsigned int i=0; i<240; i++)
				//{
				//	for (unsigned int j=0; j<384; j++)
				//	{
				//		screen_buffer[(240-i)*SCREEN_X + 256 + j] = 0x00;
				//	}
				//}
			}
			else
			{
				if (menu_wait > 0) menu_wait--;
			}

			if (menu_wait == 0)
			{
				if (menu_delay > 0) menu_delay--;

				if (menu_delay == 1)
				{
					//list_picture(menu_pos);
				}
			}
			else
			{
				menu_delay = 0x000BFFFF;
			}
		}

		screen_clear();
		audio_clear();

		if (menu_pos == 0 && directory_root == 1) // play game!
		{		
			audio_enable = 1; // audio on by default
			controller_enable = 1; // must be on to play games

			if (((controller_status_1 & 0x01) == 0x01 && (controller_status_1 & 0x02) == 0x02) || 
				((controller_status_2 & 0x01) == 0x01 && (controller_status_2 & 0x02) == 0x02) || 
				((controller_status_3 & 0x01) == 0x01 && (controller_status_3 & 0x02) == 0x02) || 
				((controller_status_4 & 0x01) == 0x01 && (controller_status_4 & 0x02) == 0x02))
			{
				cart_rom = (volatile unsigned char *)0x9D0F0000; // change cart_rom to pack-in-game
			}
			
			if ((controller_status_1 & 0x04) == 0x04 || 
				(controller_status_2 & 0x04) == 0x04 || 
				(controller_status_3 & 0x04) == 0x04 || 
				(controller_status_4 & 0x04) == 0x04)
			{
				menu_function(); // go to menu immediately if holding select
			}
			
			if ((controller_status_1 & 0x10) == 0x10 ||
				(controller_status_2 & 0x10) == 0x10 ||
				(controller_status_3 & 0x10) == 0x10 ||
				(controller_status_4 & 0x10) == 0x10) // UP, GB override
			{
				game_loop(2);
			}
			else if ((controller_status_1 & 0x40) == 0x40 ||
				(controller_status_2 & 0x40) == 0x40 ||
				(controller_status_3 & 0x40) == 0x40 ||
				(controller_status_4 & 0x40) == 0x40) // LEFT, SMS override
			{
				game_loop(3);
			}
			else if ((controller_status_1 & 0x80) == 0x80 ||
				(controller_status_2 & 0x80) == 0x80 ||
				(controller_status_3 & 0x80) == 0x80 ||
				(controller_status_4 & 0x80) == 0x80) // RIGHT, GG override
			{
				game_loop(4);
			}
			else
			{
				game_loop(0); // check rom header to decide
			}
		}
		else if (menu_pos == 0 && directory_root == 0) // return to root folder
		{
			screen_clear();
			audio_clear();

			screen_flip();
			
			// top option
			list_name[0] = 'P';
			list_name[1] = 'l';
			list_name[2] = 'a';
			list_name[3] = 'y';
			list_name[4] = ' ';
			list_name[5] = 'G';
			list_name[6] = 'a';
			list_name[7] = 'm';
			list_name[8] = 'e';
			list_name[9] = '!';
			list_name[10] = ' ';
			list_name[11] = ' ';
			
			// root directory
			directory_name[0] = '/';
			directory_name[1] = 0;
			directory_name[2] = 0;
			directory_name[3] = 0;
			directory_name[4] = 0;
			directory_name[5] = 0;
			directory_name[6] = 0;
			directory_name[7] = 0;
			directory_name[8] = 0;
			directory_name[9] = 0;
			directory_name[10] = 0;
			directory_name[11] = 0;
			
			directory_root = 1;
		}
		else // must be a file or folder
		{	
			screen_clear();
			audio_clear();

			screen_flip();

			char filename[16];

			for (int i=0; i<16; i++)
			{
				filename[i] = 0;
			}
			
			unsigned char test = 0;

			for (int i=0; i<12; i++)
			{
				filename[i] = list_name[menu_pos*12+i];
				
				if (filename[i] == '.') test = 1;
			}
			
			if (test == 0) // directory
			{
				directory_name[0] = '/';
				
				for (int i=0; i<12; i++)
				{
					directory_name[i+1] = filename[i];
					list_name[i] = filename[i];
				}
				
				directory_root = 0; // no longer root
				
				DelayMS(500);
			}
			else // file
			{
				for (unsigned long i=0; i<SCREEN_XY2; i++)
				{
					screen_buffer[i] = 0x00; // black while burning
				}

				DelayMS(500);

				screen_flip();

				DelayMS(500);

				nes_burn(directory_name, filename);
			}
		}
	}
	
	while (1)
	{
		// blink LED
		PORTDbits.RD7 = 0;
		DelayMS(100);
		DelayMS(100);
		DelayMS(100);
		DelayMS(100);
		DelayMS(100);
		
		//SendChar('0');

		PORTDbits.RD7 = 1;
		DelayMS(100);
		DelayMS(100);
		DelayMS(100);
		DelayMS(100);
		DelayMS(100);
		
		//SendChar('1');
	}
}


